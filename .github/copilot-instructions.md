# Copilot Instructions

- **Repo purpose**: A single dev container Feature set hosted on GHCR; current Feature installs the ClickHouse Local CLI for file-based SQL. Layout follows the standard Features spec in the repo root [README.md](README.md).
- **Feature structure**: Each Feature lives under `src/<feature>` with metadata in [src/clickhouse-local/devcontainer-feature.json](src/clickhouse-local/devcontainer-feature.json#L1-L20), an installer in [src/clickhouse-local/install.sh](src/clickhouse-local/install.sh#L1-L60), and tests in [test/clickhouse-local/test.sh](test/clickhouse-local/test.sh#L1-L39). Add shared test helpers in [test/_global/common-utils.sh](test/_global/common-utils.sh#L1-L24).
- **Option -> env mapping**: Feature options are exposed as uppercase env vars; `version` becomes `VERSION` and `installMethod` becomes `INSTALLMETHOD` consumed in [src/clickhouse-local/install.sh](src/clickhouse-local/install.sh#L6-L7). Defaults are `latest` and `quick` per [src/clickhouse-local/devcontainer-feature.json](src/clickhouse-local/devcontainer-feature.json#L8-L18).
- **Install methods**:
  - `quick` (default) uses the official ClickHouse quick installer, then moves the binary to `/usr/local/bin` and symlinks `clickhouse`, `clickhouse-local`, and `clickhouse-client` in [src/clickhouse-local/install.sh](src/clickhouse-local/install.sh#L38-L51).
  - `apt` adds the ClickHouse apt repo and key, then installs `clickhouse-client` with an optional pinned version in [src/clickhouse-local/install.sh](src/clickhouse-local/install.sh#L12-L36). Uses `DEBIAN_FRONTEND=noninteractive` and installs curl/gnupg prerequisites.
- **Verification**: Installer validates the binary with `clickhouse-local --version`; failures exit non-zero [src/clickhouse-local/install.sh](src/clickhouse-local/install.sh#L54-L60).
- **Testing**: Feature tests assume the command exists in PATH, check `clickhouse-local --version`, and run `SELECT 1` via stdin in [test/clickhouse-local/test.sh](test/clickhouse-local/test.sh#L10-L36). Run with `bash test/clickhouse-local/test.sh` inside a container where the Feature is installed; they honor `set -e`.
- **Shared test helpers**: Use `check`/`reportResults` utilities when adding richer tests [test/_global/common-utils.sh](test/_global/common-utils.sh#L1-L24).
- **Versioning/publishing**: Feature version is `1.0.0` in metadata [src/clickhouse-local/devcontainer-feature.json](src/clickhouse-local/devcontainer-feature.json#L2-L3). Packages publish to `ghcr.io/proxayfox/devcontainer-features/<feature>:<version>` per root guidance in [README.md](README.md#L60-L74). Keep semver in the metadata in sync with published tags.
- **Adding features**: Copy the existing pattern: create `src/<name>/devcontainer-feature.json` with options, `install.sh` for build-time install, and `test/<name>/test.sh` for validation. Update the root [README.md](README.md#L5-L52) with a short description and usage snippet.
- **Notes for edits**: Prefer minimal dependencies in installers; keep non-interactive apt usage and clean up temp GPG dirs as shown in [src/clickhouse-local/install.sh](src/clickhouse-local/install.sh#L18-L24). Preserve symlinks so both `clickhouse` and `clickhouse-local` work.
