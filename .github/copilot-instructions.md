# Copilot Instructions

- **Repo purpose**: Single dev container Feature set published to GHCR; see available Features in [README.md](README.md). Each Feature follows containers.dev spec with metadata, installer, and tests under its own folder.
- **Layout**: One Feature per subfolder in `src/<feature>` with `devcontainer-feature.json`, `install.sh`, and a matching test in `test/<feature>/test.sh`. Shared test helpers live in [test/_global/common-utils.sh](test/_global/common-utils.sh).
- **Option â†’ env mapping**: Feature options become uppercase env vars (e.g., `version` -> `VERSION`, `installMethod` -> `INSTALLMETHOD`). Default values live in each `devcontainer-feature.json`.
- **ClickHouse Local**: Defaults `version=latest`, `installMethod=quick` ([src/clickhouse-local/devcontainer-feature.json](src/clickhouse-local/devcontainer-feature.json)). Installer supports `quick` binary or `apt` path, adds key/repo when apt is chosen, creates `clickhouse-local`/`clickhouse`/`clickhouse-client` symlinks, and verifies with `clickhouse-local --version` ([src/clickhouse-local/install.sh](src/clickhouse-local/install.sh)). Tests run a `SELECT 1` sanity query ([test/clickhouse-local/test.sh](test/clickhouse-local/test.sh)).
- **Lazydocker**: Option `version` default `0.24.2` ([src/lazydocker/devcontainer-feature.json](src/lazydocker/devcontainer-feature.json)). Installer maps `uname -m` to GitHub release arch, downloads the tarball, validates gzip via `file`, installs to `/usr/local/bin`, and verifies `lazydocker --version` ([src/lazydocker/install.sh](src/lazydocker/install.sh)). Tests assert presence, version output, and executable bit ([test/lazydocker/test.sh](test/lazydocker/test.sh)).
- **Aikido pre-commit**: Options `version` (default `v1.0.116`) and `setupGlobalHooks` (default true) ([src/aikido-precommit/devcontainer-feature.json](src/aikido-precommit/devcontainer-feature.json)). Installer normalizes version prefix, downloads platform/arch-specific zip, installs `aikido-local-scanner`, and optionally wires global git `core.hooksPath` with a pre-commit snippet guarding missing binaries ([src/aikido-precommit/install.sh](src/aikido-precommit/install.sh)). Tests validate binary availability, hook configuration when enabled, and exercise `pre-commit-scan` in a temp repo ([test/aikido-precommit/test.sh](test/aikido-precommit/test.sh)).
- **Testing workflow**: Run the full suite with `devcontainer features test` or individual scripts via `bash test/<feature>/test.sh` inside a built dev container. Tests assume the feature binaries are already installed in PATH and use `set -e` for fast failures.
- **Installer conventions**: Keep installers non-interactive (`DEBIAN_FRONTEND=noninteractive`), install minimal prerequisites, and clean temp dirs/archives. Prefer `install -m 755` for binaries and confirm installs with a command run at the end.
- **Adding/updating features**: Mirror existing folder pattern, expose options in `devcontainer-feature.json`, consume them via uppercase env vars in `install.sh`, add verification to the installer, and provide a sanity test in `test/<feature>/test.sh`. Update [README.md](README.md) with a short blurb and usage snippet.
- **Publishing/versioning**: Each feature is semvered in its `devcontainer-feature.json`; images publish to `ghcr.io/proxayfox/devcontainer-features/<feature>:<version>`. Keep metadata version in sync with published tags.
